# Бот - поздравлятор с ДР

## Переменные окружения

* `BOT_TOKEN` - Токен бота

* `SHEETS_LINK` - Ссылка на таблицу

* `SHEETS_ACC` - Json строка с данными подключения к API

## Локальный запуск

Для локального запуска следует обогатить файл `.env.example` настоящими значениями и сохранить как файл `.env`.

Далее, следует запустить файл `python/main.py`

Поддерживается параметр `-D [date]` для непосредственного запуска поздравления сразу, можно указать `date` в формате `dd.mm` для указания конкретного числа для отработки расписания.

## Отладка

С целью отладки подготовлен файл `.vscode/launch.json`, который позволяет выполнить запуск программы с параметром `-D` для отладки работы программы.

## Сборка

```bash
docker build . --push -t twobrowin/hokku-birthday:latest
```

## Развёртывание

```bash
helm upgrade --install --debug -n baumanec hokku-birthday ./charts
```

## Зависимости k8s

Следует создать неймспейс `baumanec` и секрет `hokku-birthday` в нём, поля секрета:

* `bot_token` - токен подключения к Telegram боту

* `sheets_acc` - JWT токен подключения к Google Spreadsheet API

* `sheets_link` - Ссылка на подключение к требуемой таблице - боту требуется доступ на запись, может быть передан как в ссылке, так и назначен инстрементами Google Spreadsheet
